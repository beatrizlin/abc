<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>MongoDB REST Client</title>
	<meta charset="utf-8" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>
    <ul class="nav nav-pills nav-inverse">
        <li><a href="#AllProducts" data-toggle="tab">所有商品</a></li>
        <li><a href="#FindProduct" data-toggle="tab">查詢商品</a></li>
        <li><a href="#InsertProduct" data-toggle="tab">新增商品</a></li>
        <li><a href="#UpdateProduct" data-toggle="tab">修改商品</a></li>
        <li><a href="#DeleteProduct" data-toggle="tab">刪除商品</a></li>
    </ul>
    <div class="tab-content" style="padding:10px">
        <div id="AllProducts" class="tab-pane fade in active">
            <h1>所有商品</h1>
            <input type="button" value="Query" onclick="Query();" />
            <ul id='products' />
        </div>
        <div id="FindProduct" class="tab-pane fade">
            <label for="findTitle">Title:</label>
            <input type="text" id="findTitle" />
            <input type="button" value="Find" onclick="Find();" />
            <p id="product" />
        </div>
        <div id="InsertProduct" class="tab-pane fade">
            <table>
                <tr>
                    <td><label for="inssertTitle">名稱:</label></td>
                    <td><input type="text" id="inssertTitle" /></td>
                </tr>
                <tr>
                    <td><label for="insertPrice">價格:</label></td>
                    <td><input type="text" id="insertPrice" /></td>
                </tr>
                <tr>
                    <td><label for="inStock">庫存:</label></td>
                    <td><input type="text" id="insertInStock" /></td>
                </tr>
                <tr>
                    <td colspan="2"><input type="button" value="Insert" onclick="Insert();" /></td>
                </tr>
            </table>
        </div>
        <div id="UpdateProduct" class="tab-pane fade">
            <table>
                <tr>
                    <td><label for="updateTitle">名稱:</label></td>
                    <td><input type="text" id="updateTitle" /></td>
                </tr>
                <tr>
                    <td><label for="updatePrice">價格:</label></td>
                    <td><input type="text" id="updatePrice" /></td>
                </tr>
                <tr>
                    <td><label for="updateInStock">庫存:</label></td>
                    <td><input type="text" id="updateInStock" /></td>
                </tr>
                <tr>
                    <td colspan="2"><input type="button" value="Update" onclick="Update();" /></td>
                </tr>
            </table>
        </div>
        <div id="DeleteProduct" class="tab-pane fade">
            <label for="deleteTitle">Title:</label>
            <input type="text" id="deleteTitle" />
            <input type="button" value="Delete" onclick="Delete();" />
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>    <script>
        function Query() {
            $('#products').empty();
            QueryProducts(function (data) {
                var str = "";
                $.each(data, function (index, val) {
                    str += '<li>' + val._id + ', ' + val.title + ', ' + val.price + ', ' + val.instock + '</li>';
                });
                $('#products').append(str);
            });
        }
        function QueryProducts(callback) {
            $.ajax({
                url: "http://localhost:3000/api/products",
                type: "GET",
                contentType: "application/json;charset=utf-8",
            }).done(function (data) {
                callback(data);
            }).fail(function (err) {
                alert(err.responseText)
            });
        }

        function Find() {
            $('#product').empty();
            FindProduct(function (data) {
                var str = "";
                $.each(data, function (index, val) {
                    str += '<li>' + val._id + ', ' + val.title + ', ' + val.price + ', ' + val.instock + '</li>';
                });
                $('#product').append(str);
            });
        }

        function FindProduct(callback) {
            $.ajax({
                url: "http://localhost:3000/api/products/" + $("#findTitle").val(),
                type: "GET",
                contentType: "application/json;charset=utf-8",
            }).done(function (data) {
                callback(data);
            }).fail(function (err) {
                alert(err.responseText);
            });
        }

        function Insert() {
            var title = $('#inssertTitle').val();
            var price = $('#insertPrice').val();
            var instock = $('#insertInStock').val();

            var productToCreate = {
                title: title,
                price: price,
                instock: instock
            };
            InsertProduct(productToCreate, function (data) {
                alert("Product Inserted!");
            });
        }

        function InsertProduct(productToCreate, callback) {
            $.ajax({
                url: "http://localhost:3000/api/products",
                data: JSON.stringify(productToCreate),
                type: "POST",
                contentType: "application/json;charset=utf-8",
            }).done(function (data) {
                callback(data);
            }).fail(function (err) {
                alert(err.responseText);
            });
        }

        function Update() {
            var title = $('#updateTitle').val();
            var price = $('#updatePrice').val();
            var instock = $('#updateInStock').val();

            var productToUpdate = {
                title: title,
                price: price,
                instock: instock,
            };
            UpdateProduct(productToUpdate, function () {
                alert("Product Updated!");
            });
        }

        function UpdateProduct(productToUpdate, callback) {
            $.ajax({
                //url: "http://localhost:3000/api/products/" + $("#updateTitle").val(),
                url: "http://localhost:3000/api/products",
                data: JSON.stringify(productToUpdate),
                type: "PUT",
                contentType: "application/json;charset=utf-8",
            }).done(function () {
                callback();
            }).fail(function (err) {
                alert(err.responseStatus);
            });
        }

        function Delete() {
            DeleteProduct(function () {
                alert("Product Deleted!");
            });
        }
        function DeleteProduct(callback) {
            $.ajax({
                url: "http://localhost:3000/api/products/" + $("#deleteTitle").val(),
                type: "DELETE",
                contentType: "application/json;charset=utf-8",
            }).done(function () {
                callback();
            }).fail(function (err) {
                alert(err.responseText);
            });
        }
    </script>
</body>
</html>
